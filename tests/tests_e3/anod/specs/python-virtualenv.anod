import os

from e3.anod.loader import spec
from e3.anod.spec import Anod


class PythonVirtualEnv(spec('anod')):
    """A base python install.

    This is used to get a base python install that can be used with
    e3 profiles.
    """

    def setenv(self):
        if self.env.build.os.name == 'windows':
            activate_subpath = 'Scripts'
        else:
            activate_subpath = 'bin'
        activate_file = os.path.join(
            self['INSTALL_DIR'], activate_subpath, 'activate_this.py')
        execfile(activate_file, dict(__file__=activate_file))

    @Anod.primitive()
    def build(self):
        self.shell('virtualenv', self['INSTALL_DIR'])
        self.setenv()
        self.shell('pip', 'install', 'tox')
